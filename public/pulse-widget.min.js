var ProovdPulse=function(t){"use strict";class e{constructor(t,e,i,o={}){this.socket=null,this.reconnectAttempts=0,this.reconnectTimeout=null,this.handlers={stats:[],connect:[],disconnect:[],error:[]},this.isConnected=!1,this.pingInterval=null,this.lastPongTime=0;const s=void 0!==o.secure?o.secure:"undefined"!=typeof window&&"https:"===window.location.protocol||i.startsWith("wss://");this.options={clientId:t,websiteId:e,serverUrl:i,secure:s,reconnectMaxAttempts:o.reconnectMaxAttempts||10,reconnectDelay:o.reconnectDelay||2e4,debug:o.debug||!1},this.log("Initialized with options:",this.options)}connect(){return new Promise(((t,e)=>{try{if(this.socket&&this.isConnected)return this.log("Already connected to WebSocket server"),t();0===this.reconnectAttempts&&(this.reconnectAttempts=0);const i=this.buildWebSocketUrl();this.log(`Connecting to WebSocket server: ${i}`),this.socket=new WebSocket(i),this.socket.onopen=()=>{this.log("Connected to WebSocket server"),this.isConnected=!0,this.reconnectAttempts=0,this.sendMessage("join",{clientId:this.options.clientId,websiteId:this.options.websiteId}),this.startPingInterval(),this.notifyHandlers("connect",{connected:!0}),t()},this.socket.onmessage=t=>{try{const e=JSON.parse(t.data);"stats"===e.type?this.notifyHandlers("stats",e):"pong"===e.type&&(this.lastPongTime=Date.now(),this.log("Received pong from server"))}catch(t){this.log("Error parsing message",t)}},this.socket.onclose=t=>{this.log(`Connection closed: ${t.code} ${t.reason}`),this.isConnected=!1,this.stopPingInterval(),this.notifyHandlers("disconnect",{connected:!1,code:t.code,reason:t.reason}),1e3!==t.code&&this.attemptReconnect()},this.socket.onerror=t=>{this.log("WebSocket error",t),this.notifyHandlers("error",{error:t}),e(t)}}catch(t){this.log("Failed to connect",t),this.notifyHandlers("error",{error:t}),e(t)}}))}sendActivity(t){this.sendMessage("activity",{clientId:this.options.clientId,websiteId:this.options.websiteId,metrics:t})}sendPing(){this.sendMessage("ping",{clientId:this.options.clientId,timestamp:Date.now()})}startPingInterval(){this.stopPingInterval(),this.lastPongTime=Date.now(),this.pingInterval=setInterval((()=>{if(this.isActive()){this.sendPing();Date.now()-this.lastPongTime>6e4&&(this.log("No pong received for 60 seconds, reconnecting..."),this.reconnect())}}),3e4)}stopPingInterval(){null!==this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null)}disconnect(){this.socket&&this.isConnected&&(this.sendMessage("leave",{clientId:this.options.clientId,websiteId:this.options.websiteId}),this.socket.close(1e3)),this.stopPingInterval(),this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null)}reconnect(){this.socket&&this.socket.close(1001),this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.reconnectTimeout=setTimeout((()=>{this.connect().catch((t=>{this.log("Reconnect failed",t)}))}),100)}on(t,e){this.handlers[t]||(this.handlers[t]=[]),this.handlers[t].push(e)}off(t,e){this.handlers[t]&&(this.handlers[t]=this.handlers[t].filter((t=>t!==e)))}isActive(){return this.isConnected&&this.socket?.readyState===WebSocket.OPEN}sendMessage(t,e){if(this.socket&&this.isConnected)try{this.socket.send(JSON.stringify({type:t,...e}))}catch(t){this.log("Error sending message",t)}else this.log("Cannot send message, not connected")}notifyHandlers(t,e){this.handlers[t]&&this.handlers[t].forEach((i=>{try{i(e)}catch(e){this.log(`Error in ${t} handler`,e)}}))}attemptReconnect(){this.reconnectTimeout&&clearTimeout(this.reconnectTimeout);const t=this.options.reconnectMaxAttempts||5;if(this.reconnectAttempts>=t)return void this.log(`Maximum reconnect attempts (${t}) reached`);this.reconnectAttempts++;const e=this.options.reconnectDelay||2e4;this.log(`Scheduling reconnect attempt ${this.reconnectAttempts}/${t} in ${e}ms`),this.reconnectTimeout=setTimeout((()=>{this.log(`Attempting to reconnect (${this.reconnectAttempts}/${t})...`),this.connect().catch((t=>{this.log("Reconnect failed",t)}))}),e)}buildWebSocketUrl(){let t=this.options.serverUrl;const e=new URLSearchParams;return e.append("clientId",this.options.clientId),e.append("websiteId",this.options.websiteId),`${t}?${e.toString()}`}log(t,...e){this.options.debug&&console.log(`ProovdPulse Socket: ${t}`,...e)}}const i=[];for(let t=0;t<256;++t)i.push((t+256).toString(16).slice(1));let o;const s=new Uint8Array(16);var n={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function r(t,e,r){if(n.randomUUID&&!t)return n.randomUUID();const a=(t=t||{}).random??t.rng?.()??function(){if(!o){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");o=crypto.getRandomValues.bind(crypto)}return o(s)}();if(a.length<16)throw new Error("Random bytes length must be >= 16");return a[6]=15&a[6]|64,a[8]=63&a[8]|128,function(t,e=0){return(i[t[e+0]]+i[t[e+1]]+i[t[e+2]]+i[t[e+3]]+"-"+i[t[e+4]]+i[t[e+5]]+"-"+i[t[e+6]]+i[t[e+7]]+"-"+i[t[e+8]]+i[t[e+9]]+"-"+i[t[e+10]]+i[t[e+11]]+i[t[e+12]]+i[t[e+13]]+i[t[e+14]]+i[t[e+15]]).toLowerCase()}(a)}class a{constructor(t={}){this.element=null,this.container=null,this.options={position:"bottom-right",theme:"light",animations:!0,zIndex:9999,...t}}mount(){this.container?(this.element||(this.element=this.createElement(),this.applyBaseStyles(),this.container.appendChild(this.element)),this.initialize()):console.error("Widget container is not set.")}initialize(){}applyBaseStyles(){if(this.element){switch(this.element.style.position="absolute",this.options.position){case"top-left":this.element.style.top="20px",this.element.style.left="20px";break;case"top-right":this.element.style.top="20px",this.element.style.right="20px";break;case"bottom-left":this.element.style.bottom="20px",this.element.style.left="20px";break;default:this.element.style.bottom="20px",this.element.style.right="20px"}void 0!==this.options.zIndex&&(this.element.style.zIndex=this.options.zIndex.toString()),this.element.dataset.theme=this.options.theme,!1===this.options.animations&&(this.element.dataset.animations="false"),this.options.className&&this.element.classList.add(this.options.className),this.options.style&&Object.assign(this.element.style,this.options.style)}}unmount(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null}}class l extends a{constructor(t={}){super(t),this.count=0,this.hideTimeout=null,this.productElements=[],this.productIndicators=new Map,this.options={minViewers:1,maxViewers:100,prefix:"",suffix:"",smartText:!0,singularText:"person viewing",pluralText:"people viewing",showPulse:!0,textColor:"#ffffff",backgroundColor:"#1e3a8a",pulseColor:"#3b82f6",autoHideAfter:0,expandOnHover:!0,...t}}createElement(){const t=document.createElement("div");if(t.className="proovd-viewer-indicator",t.style.display="flex",t.style.alignItems="center",t.style.padding="6px 12px",t.style.borderRadius="50px",t.style.backgroundColor=this.options.backgroundColor,t.style.color=this.options.textColor,t.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif',t.style.fontSize="14px",t.style.boxShadow="0 2px 5px rgba(0, 0, 0, 0.1)",t.style.transition="all 0.3s ease",t.style.cursor="default",this.options.showPulse){const e=document.createElement("div");e.className="proovd-viewer-pulse",e.style.width="8px",e.style.height="8px",e.style.borderRadius="50%",e.style.backgroundColor=this.options.pulseColor,e.style.marginRight="8px",e.style.position="relative",e.innerHTML=`\n        <style>\n          .proovd-viewer-pulse:before {\n            content: '';\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            border-radius: 50%;\n            background-color: ${this.options.pulseColor};\n            opacity: 0.4;\n            animation: proovd-pulse 2s infinite ease-in-out;\n          }\n          \n          @keyframes proovd-pulse {\n            0% {\n              transform: scale(1);\n              opacity: 0.4;\n            }\n            50% {\n              transform: scale(2.5);\n              opacity: 0;\n            }\n            100% {\n              transform: scale(1);\n              opacity: 0.4;\n            }\n          }\n        </style>\n      `,t.appendChild(e)}const e=document.createElement("span");return e.className="proovd-viewer-text",t.appendChild(e),this.options.expandOnHover&&(t.addEventListener("mouseenter",(()=>{t.style.transform="translateY(-3px)",t.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.15)"})),t.addEventListener("mouseleave",(()=>{t.style.transform="translateY(0)",t.style.boxShadow="0 2px 5px rgba(0, 0, 0, 0.1)"}))),t.style.display="none",t}initialize(){if(this.options.productSelector){this.findProductElements();new MutationObserver((()=>{this.findProductElements()})).observe(document.body,{childList:!0,subtree:!0})}}findProductElements(){if(!this.options.productSelector)return;const t=Array.from(document.querySelectorAll(this.options.productSelector)).filter((t=>!this.productElements.includes(t)));if(t.length>0){this.productElements.push(...t);for(const e of t)this.createProductIndicator(e)}}createProductIndicator(t){const e=this.createElement();switch(e.style.position="absolute",this.options.productPosition){case"top-left":e.style.top="10px",e.style.left="10px";break;case"top-right":e.style.top="10px",e.style.right="10px";break;case"bottom-left":e.style.bottom="10px",e.style.left="10px";break;default:e.style.bottom="10px",e.style.right="10px"}"static"===window.getComputedStyle(t).position&&(t.style.position="relative"),t.appendChild(e),this.productIndicators.set(t,e),this.updateIndicatorText(e)}update(t){if("number"==typeof t.count){this.count=Math.min(t.count,this.options.maxViewers),!this.options.productSelector&&this.element&&this.updateIndicatorText(this.element);for(const t of this.productIndicators.values())this.updateIndicatorText(t);this.options.autoHideAfter&&this.options.autoHideAfter>0&&(null!==this.hideTimeout&&window.clearTimeout(this.hideTimeout),this.hideTimeout=window.setTimeout((()=>{this.element&&(this.element.style.display="none");for(const t of this.productIndicators.values())t.style.display="none"}),this.options.autoHideAfter))}}updateIndicatorText(t){if(this.count<this.options.minViewers)return void(t.style.display="none");const e=t.querySelector(".proovd-viewer-text");if(!e)return;let i="";this.options.smartText&&(i=1===this.count?this.options.singularText:this.options.pluralText),e.textContent=`${this.options.prefix} ${this.count} ${i} ${this.options.suffix}`.trim(),t.style.display="flex"}unmount(){for(const[t,e]of this.productIndicators.entries())e.parentNode&&e.parentNode.removeChild(e);this.productIndicators.clear(),this.productElements=[],null!==this.hideTimeout&&(window.clearTimeout(this.hideTimeout),this.hideTimeout=null),super.unmount()}}class c extends a{constructor(t={}){super(t),this.notifications=[],this.notificationQueue=[],this.isProcessingQueue=!1,this.options={maxNotifications:3,displayTime:5e3,showTimeAgo:!0,showLocation:!0,template:"Someone from {{location}} purchased {{name}} {{timeAgo}}",backgroundColor:"#ffffff",textColor:"#1f2937",accentColor:"#3b82f6",showProductImage:!0,animationStyle:"slide",queueBehavior:"stack",stackGap:10,...t}}createElement(){const t=document.createElement("div");switch(t.className="proovd-purchase-notification-container",t.style.display="flex",t.style.flexDirection="column",t.style.gap=`${this.options.stackGap}px`,this.options.position){case"top-left":case"bottom-left":t.style.alignItems="flex-start";break;default:t.style.alignItems="flex-end"}return t}update(t){t&&t.productName&&(this.notificationQueue.push(t),this.isProcessingQueue||this.processQueue())}processQueue(){if(0===this.notificationQueue.length)return void(this.isProcessingQueue=!1);this.isProcessingQueue=!0;const t=this.notificationQueue.shift();this.showNotification(t),setTimeout((()=>{this.processQueue()}),300)}showNotification(t){if(!this.element)return;const e=document.createElement("div");e.className="proovd-purchase-notification",e.style.backgroundColor=this.options.backgroundColor,e.style.color=this.options.textColor,e.style.borderLeft=`4px solid ${this.options.accentColor}`,e.style.borderRadius="6px",e.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)",e.style.padding="12px",e.style.width="280px",e.style.maxWidth="90vw",e.style.boxSizing="border-box",e.style.position="relative",e.style.overflow="hidden",this.applyEntranceAnimation(e);const i=document.createElement("div");if(i.style.display="flex",i.style.gap="12px",this.options.showProductImage&&t.image){const e=document.createElement("div");e.style.width="48px",e.style.height="48px",e.style.flexShrink="0",e.style.borderRadius="4px",e.style.overflow="hidden";const o=document.createElement("img");o.src=t.image,o.alt=t.productName,o.style.width="100%",o.style.height="100%",o.style.objectFit="cover",e.appendChild(o),i.appendChild(e)}const o=document.createElement("div");o.style.flex="1";const s=this.applyTemplate(t);if(o.textContent=s,t.price){const e=document.createElement("div");e.style.fontWeight="bold",e.style.marginTop="4px";let i="";if("number"==typeof t.price)if(t.currency)try{i=new Intl.NumberFormat("en-US",{style:"currency",currency:t.currency}).format(t.price)}catch(e){i=`${t.currency} ${t.price}`}else i=t.price.toString();else i=t.price;e.textContent=i,o.appendChild(e)}i.appendChild(o),e.appendChild(i);const n=document.createElement("div");n.className="proovd-notification-progress",n.style.position="absolute",n.style.bottom="0",n.style.left="0",n.style.height="2px",n.style.backgroundColor=this.options.accentColor,n.style.width="100%",n.style.transform="scaleX(1)",n.style.transformOrigin="left",n.style.transition=`transform ${this.options.displayTime}ms linear`,e.appendChild(n);const r=document.createElement("button");if(r.className="proovd-notification-close",r.innerHTML="&times;",r.style.position="absolute",r.style.top="8px",r.style.right="8px",r.style.background="none",r.style.border="none",r.style.color=this.options.textColor,r.style.fontSize="16px",r.style.cursor="pointer",r.style.opacity="0.5",r.style.transition="opacity 0.2s",r.addEventListener("mouseenter",(()=>{r.style.opacity="1"})),r.addEventListener("mouseleave",(()=>{r.style.opacity="0.5"})),r.addEventListener("click",(()=>{this.removeNotification(e)})),e.appendChild(r),"replace"===this.options.queueBehavior&&this.notifications.length>=this.options.maxNotifications){const t=this.notifications.shift();t&&t.parentNode&&t.parentNode.removeChild(t)}else if(this.notifications.length>=this.options.maxNotifications)return;this.notifications.push(e),this.element.appendChild(e),setTimeout((()=>{n.style.transform="scaleX(0)"}),10),setTimeout((()=>{this.removeNotification(e)}),this.options.displayTime)}removeNotification(t){t.parentNode&&this.applyExitAnimation(t,(()=>{t.parentNode&&t.parentNode.removeChild(t);const e=this.notifications.indexOf(t);-1!==e&&this.notifications.splice(e,1)}))}applyEntranceAnimation(t){switch(this.options.animationStyle){case"fade":t.style.opacity="0",t.style.transition="opacity 0.3s ease-in-out",setTimeout((()=>{t.style.opacity="1"}),10);break;case"pop":t.style.transform="scale(0.8)",t.style.opacity="0",t.style.transition="transform 0.3s ease-out, opacity 0.3s ease-out",setTimeout((()=>{t.style.transform="scale(1)",t.style.opacity="1"}),10);break;default:t.style.transform="translateX(100%)",t.style.transition="transform 0.3s ease-out","top-left"!==this.options.position&&"bottom-left"!==this.options.position||(t.style.transform="translateX(-100%)"),setTimeout((()=>{t.style.transform="translateX(0)"}),10)}}applyExitAnimation(t,e){let i=300;switch(this.options.animationStyle){case"fade":t.style.opacity="0",t.style.transition="opacity 300ms ease-in-out";break;case"pop":t.style.transform="scale(0.8)",t.style.opacity="0",t.style.transition="transform 300ms ease-in, opacity 300ms ease-in";break;default:t.style.transform="translateX(100%)",t.style.transition="transform 300ms ease-in","top-left"!==this.options.position&&"bottom-left"!==this.options.position||(t.style.transform="translateX(-100%)")}setTimeout(e,i)}applyTemplate(t){let e=this.options.template;if(e=e.replace(/{{name}}/g,t.productName),e=this.options.showLocation&&t.location?e.replace(/{{location}}/g,t.location):e.replace(/{{location}}/g,"somewhere"),this.options.showTimeAgo){const i=this.formatTimeAgo(t.timestamp);e=e.replace(/{{timeAgo}}/g,i)}else e=e.replace(/{{timeAgo}}/g,"");return e}formatTimeAgo(t){const e=t instanceof Date?t:new Date(t),i=new Date,o=Math.floor((i.getTime()-e.getTime())/1e3);if(o<60)return"just now";const s=Math.floor(o/60);if(s<60)return`${s} minute${s>1?"s":""} ago`;const n=Math.floor(s/60);if(n<24)return`${n} hour${n>1?"s":""} ago`;const r=Math.floor(n/24);if(r<30)return`${r} day${r>1?"s":""} ago`;const a=Math.floor(r/30);if(a<12)return`${a} month${a>1?"s":""} ago`;const l=Math.floor(a/12);return`${l} year${l>1?"s":""} ago`}unmount(){this.notifications.forEach((t=>{t.parentNode&&t.parentNode.removeChild(t)})),this.notifications=[],this.notificationQueue=[],this.isProcessingQueue=!1,super.unmount()}}class d{constructor(t){this.container=null,this.element=null,this.currentStock=0,this.config=t;this.options={position:"bottom-left",lowStockThreshold:10,criticalStockThreshold:5,showActualCount:!0,pulseAnimation:!0,backgroundColor:"#FFFFFF",lowStockColor:"#F59E0B",criticalStockColor:"#EF4444",textColor:"#374151",fontSize:"14px",...t.options||{}}}mount(t){this.element&&this.unmount(),this.container=t,this.element=document.createElement("div"),this.element.className="proovd-pulse-stock-status",this.applyStyles(this.element,{position:"absolute",...this.getPositionStyles(),display:"flex",alignItems:"center",gap:"8px",padding:"6px 12px",borderRadius:"6px",backgroundColor:this.options.backgroundColor,boxShadow:"0 2px 5px rgba(0, 0, 0, 0.1)",color:this.options.textColor,fontSize:this.options.fontSize,fontWeight:"500",zIndex:"5",transition:"all 0.3s ease",opacity:"0",transform:"translateY(10px)",pointerEvents:"none"}),this.container.appendChild(this.element)}update(t){if(!this.element||"number"!=typeof t.currentStock)return;const e=this.currentStock;this.currentStock=t.currentStock;let i="",o=this.options.textColor;if(this.currentStock<=this.options.criticalStockThreshold)i=this.options.showActualCount?`Only ${this.currentStock} left in stock!`:"Almost sold out!",o=this.options.criticalStockColor,this.options.pulseAnimation&&this.applyPulseAnimation();else{if(!(this.currentStock<=this.options.lowStockThreshold))return void this.hideWidget();i=this.options.showActualCount?`Only ${this.currentStock} left in stock`:"Low stock available",o=this.options.lowStockColor}this.showWidget(i,o),e>0&&this.currentStock<e&&this.animateStockChange()}showWidget(t,e){this.element&&(this.element.textContent=t,this.element.style.color=e,this.applyStyles(this.element,{opacity:"1",transform:"translateY(0)"}))}hideWidget(){this.element&&this.applyStyles(this.element,{opacity:"0",transform:"translateY(10px)"})}animateStockChange(){if(!this.element)return;const t=document.createElement("div");t.className="proovd-pulse-stock-flash",this.applyStyles(t,{position:"absolute",inset:"0",backgroundColor:this.options.criticalStockColor,opacity:"0.3",borderRadius:"6px",pointerEvents:"none"}),this.element.appendChild(t),setTimeout((()=>{this.applyStyles(t,{opacity:"0",transition:"opacity 0.5s ease"}),setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t)}),500)}),10)}applyPulseAnimation(){if(!this.element)return;let t=document.getElementById("proovd-pulse-stock-animation-style");t||(t=document.createElement("style"),t.id="proovd-pulse-stock-animation-style",t.textContent="\n        @keyframes proovdPulseStock {\n          0% { transform: scale(1); }\n          50% { transform: scale(1.03); }\n          100% { transform: scale(1); }\n        }\n      ",document.head.appendChild(t)),this.applyStyles(this.element,{animation:"proovdPulseStock 2s infinite"})}unmount(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.container=null}getPositionStyles(){switch(this.options.position){case"top-left":return{top:"10px",left:"10px"};case"top-right":return{top:"10px",right:"10px"};case"bottom-left":default:return{bottom:"10px",left:"10px"};case"bottom-right":return{bottom:"10px",right:"10px"}}}applyStyles(t,e){Object.entries(e).forEach((([e,i])=>{t.style[e]=i}))}}class h extends a{constructor(t={}){super(t),this.countdownIntervals=new Map,this.urgencyData=new Map,this.productIndicators=new Map,this.globalEndTime=null,this.defaultId="global",this.observer=null,this.options={type:"countdown",prefix:"",suffix:"",showDays:!0,showHours:!0,showMinutes:!0,showSeconds:!0,countdownFormat:"{d}d {h}h {m}m {s}s",endMessage:"Offer ended",backgroundColor:"#ef4444",textColor:"#ffffff",pulseAnimation:!0,flashWhenEnding:!0,endingSoonThreshold:300,productSelector:"[data-product]",productIdAttribute:"data-product-id",...t}}createElement(){const t=document.createElement("div");return t.className="proovd-urgency-indicator",t.style.display="flex",t.style.alignItems="center",t.style.gap="8px",t.style.padding="8px 12px",t.style.borderRadius="4px",t.style.fontSize="14px",t.style.fontWeight="600",t.style.backgroundColor=this.options.backgroundColor,t.style.color=this.options.textColor,this.options.pulseAnimation&&this.addPulseAnimation(t),t}initialize(){this.options.productSelector?(this.observer=new MutationObserver(this.handleDOMChanges.bind(this)),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:[this.options.productIdAttribute]}),this.findProductElements()):this.setupGlobalIndicator()}handleDOMChanges(){this.findProductElements()}findProductElements(){if(!this.options.productSelector)return;const t=Array.from(document.querySelectorAll(this.options.productSelector));for(const e of t){const t=e.getAttribute(this.options.productIdAttribute);if(!t)continue;let i=!1;const o=this.productIndicators.get(t)||[];for(const t of o)if(t.parentNode===e){i=!0;break}if(i)continue;const s=this.createElement();e.appendChild(s),this.productIndicators.has(t)||this.productIndicators.set(t,[]),this.productIndicators.get(t).push(s),this.urgencyData.has(t)&&this.updateIndicator(s,this.urgencyData.get(t))}}setupGlobalIndicator(){this.element&&(this.urgencyData.has(this.defaultId)||this.urgencyData.set(this.defaultId,{type:this.options.type,message:"Limited Time Offer"}),this.updateIndicator(this.element,this.urgencyData.get(this.defaultId)))}update(t){if(!t||!t.type)return;const e=t.productId||this.defaultId;this.urgencyData.set(e,t),"countdown"===t.type&&t.endTime&&this.setupCountdown(e,t.endTime),e===this.defaultId&&this.element?this.updateIndicator(this.element,t):this.productIndicators.has(e)&&this.productIndicators.get(e).forEach((e=>{this.updateIndicator(e,t)}))}updateIndicator(t,e){let i="";switch(e.type){case"countdown":if(e.endTime){const o=this.getTimeLeft(e.endTime);o<=0?i=this.options.endMessage:(i=this.formatCountdown(o),this.options.flashWhenEnding&&o<=this.options.endingSoonThreshold?this.addFlashingEffect(t):this.removeFlashingEffect(t))}break;case"limited-time":i=e.message||"Limited Time Offer";break;case"hot-item":i=e.viewCount?`ðŸ”¥ ${e.viewCount} people viewing`:e.purchaseCount?`ðŸ”¥ ${e.purchaseCount} sold recently`:e.message||"Hot Item"}const o=`${this.options.prefix} ${i} ${this.options.suffix}`.trim();t.textContent=o}setupCountdown(t,e){this.countdownIntervals.has(t)&&window.clearInterval(this.countdownIntervals.get(t)),this.globalEndTime="string"==typeof e?new Date(e).getTime():e;const i=window.setInterval((()=>{const e=this.getTimeLeft(this.globalEndTime);if(t===this.defaultId&&this.element){const e=this.urgencyData.get(t);this.updateIndicator(this.element,e)}else if(this.productIndicators.has(t)){const e=this.urgencyData.get(t);this.productIndicators.get(t).forEach((t=>{this.updateIndicator(t,e)}))}e<=0&&(window.clearInterval(i),this.countdownIntervals.delete(t))}),1e3);this.countdownIntervals.set(t,i)}getTimeLeft(t){const e="string"==typeof t?new Date(t).getTime():t,i=Date.now();return Math.max(0,Math.floor((e-i)/1e3))}formatCountdown(t){const e=Math.floor(t/86400),i=Math.floor(t%86400/3600),o=Math.floor(t%3600/60),s=t%60;let n=this.options.countdownFormat;return this.options.showDays||(n=n.replace(/{d}d\s?/g,"")),this.options.showHours||(n=n.replace(/{h}h\s?/g,"")),this.options.showMinutes||(n=n.replace(/{m}m\s?/g,"")),this.options.showSeconds||(n=n.replace(/{s}s\s?/g,"")),n.replace("{d}",e.toString()).replace("{h}",i.toString().padStart(2,"0")).replace("{m}",o.toString().padStart(2,"0")).replace("{s}",s.toString().padStart(2,"0"))}addPulseAnimation(t){if(t.classList.add("proovd-pulse-animation"),!document.getElementById("proovd-pulse-style")){const t=document.createElement("style");t.id="proovd-pulse-style",t.textContent="\n        @keyframes proovdPulse {\n          0% { transform: scale(1); }\n          50% { transform: scale(1.03); }\n          100% { transform: scale(1); }\n        }\n        \n        .proovd-pulse-animation {\n          animation: proovdPulse 2s infinite ease-in-out;\n        }\n      ",document.head.appendChild(t)}}addFlashingEffect(t){if(!t.classList.contains("proovd-flash-animation")&&(t.classList.add("proovd-flash-animation"),!document.getElementById("proovd-flash-style"))){const t=document.createElement("style");t.id="proovd-flash-style",t.textContent="\n        @keyframes proovdFlash {\n          0% { opacity: 1; }\n          50% { opacity: 0.7; }\n          100% { opacity: 1; }\n        }\n        \n        .proovd-flash-animation {\n          animation: proovdFlash 0.8s infinite ease-in-out;\n        }\n      ",document.head.appendChild(t)}}removeFlashingEffect(t){t.classList.remove("proovd-flash-animation")}unmount(){for(const t of this.countdownIntervals.values())window.clearInterval(t);this.countdownIntervals.clear(),this.observer&&(this.observer.disconnect(),this.observer=null);for(const t of this.productIndicators.values())for(const e of t)e.parentNode&&e.parentNode.removeChild(e);this.productIndicators.clear(),this.urgencyData.clear(),super.unmount()}}class p{constructor(t={}){this.container=null,this.data={},this.elements={},this.chartInstance=null,this.refreshTimer=null,this.expanded=!1,this.chartLibraryLoaded=!1,this.options={position:t.options?.position||"bottom-right",theme:t.options?.theme||"light",showInactiveUsers:void 0===t.options?.showInactiveUsers||t.options.showInactiveUsers,inactiveThreshold:t.options?.inactiveThreshold||300,chartType:t.options?.chartType||"line",metrics:t.options?.metrics||["viewers","clicks","scrollDepth","timeOnPage"],refreshInterval:t.options?.refreshInterval||30,showRealTime:void 0===t.options?.showRealTime||t.options.showRealTime,compactView:void 0===t.options?.compactView||t.options.compactView,dashboardLink:t.options?.dashboardLink||"",customColors:t.options?.customColors||["#4C6FFF","#FF6B6B","#32D583","#F2994A","#BB6BD9"]};const e=window.widgetRegistryContainer;e&&(this.container=e)}mount(){this.container?(this.render(),this.loadDependencies(),this.options.refreshInterval&&this.options.refreshInterval>0&&this.startRefreshTimer()):console.error("Analytics Widget: Container is not available")}unmount(){null!==this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null),this.chartInstance&&(this.chartInstance=null),this.container&&this.elements.widget&&this.container.removeChild(this.elements.widget),this.elements={}}update(t){"analytics"!==t.type&&"stats"!==t.type||(void 0!==t.activeUsers&&(this.data.activeUsers=t.activeUsers),void 0!==t.inactiveUsers&&(this.data.inactiveUsers=t.inactiveUsers),void 0!==t.totalUsers&&(this.data.totalUsers=t.totalUsers),void 0!==t.pageViews&&(this.data.pageViews=t.pageViews),void 0!==t.avgTimeOnPage&&(this.data.avgTimeOnPage=t.avgTimeOnPage),void 0!==t.bounceRate&&(this.data.bounceRate=t.bounceRate),void 0!==t.conversionRate&&(this.data.conversionRate=t.conversionRate),void 0!==t.clickCount&&(this.data.clickCount=t.clickCount),void 0!==t.avgScrollDepth&&(this.data.avgScrollDepth=t.avgScrollDepth),void 0!==t.purchaseCount&&(this.data.purchaseCount=t.purchaseCount),void 0!==t.timeSeriesData&&(this.data.timeSeriesData=t.timeSeriesData),this.updateUI())}destroy(){this.unmount()}render(){if(!this.container)return;const t=document.createElement("div");t.className="proovd-analytics-widget",t.setAttribute("data-theme",this.options.theme||"light"),t.setAttribute("data-position",this.options.position||"bottom-right"),t.setAttribute("data-view",this.options.compactView?"compact":"full");const e=this.getStyles(),i=document.createElement("style");i.textContent=e,t.appendChild(i);const o=document.createElement("div");o.className="proovd-analytics-header";const s=document.createElement("div");s.className="proovd-analytics-title",s.textContent="ProovdPulse Analytics",o.appendChild(s);const n=document.createElement("div");n.className="proovd-analytics-controls";const r=document.createElement("button");r.className="proovd-analytics-refresh",r.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>',r.addEventListener("click",(()=>this.refreshData())),n.appendChild(r);const a=document.createElement("button");a.className="proovd-analytics-expand",a.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>',a.addEventListener("click",(()=>this.toggleExpand())),n.appendChild(a);const l=document.createElement("button");l.className="proovd-analytics-close",l.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>',l.addEventListener("click",(()=>this.hide())),n.appendChild(l),o.appendChild(n),t.appendChild(o);const c=document.createElement("div");c.className="proovd-analytics-body";const d=document.createElement("div");d.className="proovd-analytics-metrics",c.appendChild(d);const h=document.createElement("div");if(h.className="proovd-analytics-chart",c.appendChild(h),t.appendChild(c),this.options.dashboardLink){const e=document.createElement("div");e.className="proovd-analytics-footer";const i=document.createElement("a");i.href=this.options.dashboardLink,i.target="_blank",i.textContent="View Full Dashboard",i.className="proovd-analytics-dashboard-link",e.appendChild(i),t.appendChild(e)}this.elements.widget=t,this.elements.header=o,this.elements.body=c,this.elements.chart=h,this.elements.metrics=d,this.elements.expandButton=a,this.elements.closeButton=l,this.elements.refreshButton=r,this.container.appendChild(t),this.updateUI()}updateUI(){this.elements.metrics&&this.data&&(this.elements.metrics.innerHTML="",!this.options.metrics?.includes("viewers")||void 0===this.data.activeUsers&&void 0===this.data.totalUsers||(this.createMetricCard("Active Users",this.data.activeUsers||0,"users"),this.options.showInactiveUsers&&void 0!==this.data.inactiveUsers&&this.createMetricCard("Inactive Users",this.data.inactiveUsers,"users"),void 0!==this.data.totalUsers&&this.createMetricCard("Total Users",this.data.totalUsers,"users")),this.options.metrics?.includes("clicks")&&void 0!==this.data.clickCount&&this.createMetricCard("Clicks",this.data.clickCount,"clicks"),this.options.metrics?.includes("scrollDepth")&&void 0!==this.data.avgScrollDepth&&this.createMetricCard("Avg Scroll Depth",this.data.avgScrollDepth,"percent"),this.options.metrics?.includes("timeOnPage")&&void 0!==this.data.avgTimeOnPage&&this.createMetricCard("Avg Time on Page",this.formatTime(this.data.avgTimeOnPage),""),this.options.metrics?.includes("purchases")&&void 0!==this.data.purchaseCount&&(this.createMetricCard("Purchases",this.data.purchaseCount,"count"),void 0!==this.data.conversionRate&&this.createMetricCard("Conversion Rate",this.data.conversionRate,"percent")),this.updateChart())}createMetricCard(t,e,i){if(!this.elements.metrics)return;const o=document.createElement("div");o.className="proovd-analytics-metric-card";const s=document.createElement("div");s.className="proovd-analytics-metric-label",s.textContent=t,o.appendChild(s);const n=document.createElement("div");n.className="proovd-analytics-metric-value";let r=e;"percent"===i&&"number"==typeof e?r=`${e.toFixed(1)}%`:"users"!==i&&"clicks"!==i&&"count"!==i||(r="number"==typeof e?e.toLocaleString():e),n.textContent=r.toString(),o.appendChild(n),this.elements.metrics.appendChild(o)}updateChart(){this.elements.chart&&this.chartLibraryLoaded&&(this.data.timeSeriesData?this.chartInstance||(this.elements.chart.innerHTML='<div class="proovd-analytics-chart-placeholder">Chart will appear here once data is available</div>'):this.elements.chart.innerHTML='<div class="proovd-analytics-chart-placeholder">No time series data available</div>')}loadDependencies(){if(window.Chart)return this.chartLibraryLoaded=!0,void this.updateChart();const t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/chart.js",t.async=!0,t.onload=()=>{this.chartLibraryLoaded=!0,this.updateChart()},document.head.appendChild(t)}startRefreshTimer(){null!==this.refreshTimer&&clearInterval(this.refreshTimer),this.refreshTimer=window.setInterval((()=>{this.options.showRealTime&&this.refreshData()}),1e3*(this.options.refreshInterval||30))}refreshData(){const t=new CustomEvent("proovdpulse:refresh-analytics",{detail:{timestamp:(new Date).toISOString()}});document.dispatchEvent(t)}toggleExpand(){this.elements.widget&&(this.expanded=!this.expanded,this.elements.widget.setAttribute("data-view",this.expanded?"full":"compact"),this.elements.expandButton&&(this.elements.expandButton.innerHTML=this.expanded?'<svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/></svg>':'<svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>'),this.expanded&&window.setTimeout((()=>this.updateChart()),300))}hide(){this.elements.widget&&(this.elements.widget.style.display="none")}formatTime(t){if(t<60)return`${t}s`;if(t<3600){return`${Math.floor(t/60)}m ${t%60}s`}return`${Math.floor(t/3600)}h ${Math.floor(t%3600/60)}m`}getStyles(){return'\n      .proovd-analytics-widget {\n        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;\n        font-size: 14px;\n        line-height: 1.5;\n        background-color: var(--proovd-bg-color, #ffffff);\n        color: var(--proovd-text-color, #333333);\n        border-radius: 8px;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n        overflow: hidden;\n        width: 300px;\n        transition: all 0.3s ease;\n        transform-origin: bottom right;\n        max-height: 500px;\n      }\n      \n      .proovd-analytics-widget[data-theme="dark"] {\n        --proovd-bg-color: #24292e;\n        --proovd-text-color: #ffffff;\n        --proovd-border-color: #444444;\n        --proovd-card-bg: #2d333b;\n        --proovd-accent-color: #58a6ff;\n      }\n      \n      .proovd-analytics-widget[data-theme="light"] {\n        --proovd-bg-color: #ffffff;\n        --proovd-text-color: #333333;\n        --proovd-border-color: #e1e4e8;\n        --proovd-card-bg: #f6f8fa;\n        --proovd-accent-color: #4C6FFF;\n      }\n      \n      .proovd-analytics-widget[data-position="bottom-right"] {\n        position: fixed;\n        bottom: 20px;\n        right: 20px;\n      }\n      \n      .proovd-analytics-widget[data-position="bottom-left"] {\n        position: fixed;\n        bottom: 20px;\n        left: 20px;\n      }\n      \n      .proovd-analytics-widget[data-position="top-right"] {\n        position: fixed;\n        top: 20px;\n        right: 20px;\n      }\n      \n      .proovd-analytics-widget[data-position="top-left"] {\n        position: fixed;\n        top: 20px;\n        left: 20px;\n      }\n      \n      .proovd-analytics-widget[data-position="floating"] {\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n      }\n      \n      .proovd-analytics-widget[data-view="compact"] {\n        height: auto;\n      }\n      \n      .proovd-analytics-widget[data-view="full"] {\n        width: 600px;\n        height: 400px;\n      }\n      \n      .proovd-analytics-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 12px 16px;\n        border-bottom: 1px solid var(--proovd-border-color, #e1e4e8);\n      }\n      \n      .proovd-analytics-title {\n        font-weight: 600;\n        font-size: 16px;\n      }\n      \n      .proovd-analytics-controls {\n        display: flex;\n        gap: 8px;\n      }\n      \n      .proovd-analytics-controls button {\n        background: none;\n        border: none;\n        cursor: pointer;\n        width: 24px;\n        height: 24px;\n        border-radius: 4px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        color: var(--proovd-text-color, #333333);\n        opacity: 0.7;\n        transition: all 0.2s ease;\n      }\n      \n      .proovd-analytics-controls button:hover {\n        opacity: 1;\n        background-color: rgba(0, 0, 0, 0.05);\n      }\n      \n      .proovd-analytics-widget[data-theme="dark"] .proovd-analytics-controls button:hover {\n        background-color: rgba(255, 255, 255, 0.1);\n      }\n      \n      .proovd-analytics-body {\n        padding: 16px;\n        overflow-y: auto;\n        max-height: calc(100% - 52px);\n      }\n      \n      .proovd-analytics-metrics {\n        display: grid;\n        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));\n        gap: 12px;\n        margin-bottom: 16px;\n      }\n      \n      .proovd-analytics-widget[data-view="full"] .proovd-analytics-metrics {\n        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));\n      }\n      \n      .proovd-analytics-metric-card {\n        background-color: var(--proovd-card-bg, #f6f8fa);\n        border-radius: 6px;\n        padding: 12px;\n        text-align: center;\n      }\n      \n      .proovd-analytics-metric-label {\n        font-size: 12px;\n        color: var(--proovd-text-color, #333333);\n        opacity: 0.8;\n        margin-bottom: 4px;\n      }\n      \n      .proovd-analytics-metric-value {\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--proovd-accent-color, #4C6FFF);\n      }\n      \n      .proovd-analytics-chart {\n        height: 200px;\n        display: none;\n      }\n      \n      .proovd-analytics-widget[data-view="full"] .proovd-analytics-chart {\n        display: block;\n      }\n      \n      .proovd-analytics-chart-placeholder {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        height: 100%;\n        background-color: var(--proovd-card-bg, #f6f8fa);\n        border-radius: 6px;\n        opacity: 0.6;\n        font-size: 14px;\n      }\n      \n      .proovd-analytics-footer {\n        padding: 8px 16px;\n        text-align: center;\n        border-top: 1px solid var(--proovd-border-color, #e1e4e8);\n      }\n      \n      .proovd-analytics-dashboard-link {\n        color: var(--proovd-accent-color, #4C6FFF);\n        text-decoration: none;\n        font-size: 13px;\n      }\n      \n      .proovd-analytics-dashboard-link:hover {\n        text-decoration: underline;\n      }\n    '}}const u=new class{constructor(){this.registry=new Map,this.instances=new Map,this.activeWidgets=[],this.container=null,this.register("viewers",l),this.register("purchases",c),this.register("stock",d),this.register("urgency",h),this.register("analytics",p),"undefined"!=typeof window&&(window.widgetRegistryContainer=this.container)}register(t,e){this.registry.has(t)&&console.warn(`ProovdPulse: Widget type '${t}' is already registered. Overwriting.`),this.registry.set(t,e)}setContainer(t){this.container=t,"undefined"!=typeof window&&(window.widgetRegistryContainer=this.container),this.instances.size>0&&this.activeWidgets.forEach((t=>{const e=this.instances.get(t);e&&this.container&&e.mount(this.container)}))}initialize(t){this.cleanUp(),this.container?t.forEach((t=>{if(t.enabled&&this.registry.has(t.type))try{const e=new(this.registry.get(t.type))(t);this.instances.set(t.type,e),this.activeWidgets.push(t.type),e.mount(this.container)}catch(e){console.error(`ProovdPulse: Failed to initialize widget '${t.type}'`,e)}})):console.error("ProovdPulse: Cannot initialize widgets without a container")}update(t,e){if(e&&this.instances.has(e)){const i=this.instances.get(e);i&&i.update(t)}else this.activeWidgets.forEach((e=>{const i=this.instances.get(e);i&&i.update(t)}))}cleanUp(){this.activeWidgets.forEach((t=>{const e=this.instances.get(t);e&&e.unmount()})),this.instances.clear(),this.activeWidgets=[]}getAvailableWidgetTypes(){return Array.from(this.registry.keys())}hasWidgetType(t){return this.registry.has(t)}getActiveWidgetTypes(){return[...this.activeWidgets]}};class m{constructor(t){if(this.metrics={clickCount:0,scrollPercentage:0,timeOnPage:0},this.isTracking=!1,this.startTime=0,this.activityInterval=null,this.maxScrollPercentage=0,this.clickHandler=null,this.scrollHandler=null,this.reconnectAttempts=0,this.container=null,this.shadow=null,this.widgetsContainer=null,this.options={...t},this.options.clientId||(this.options.clientId=this.getClientId()),this.isProduction="undefined"!=typeof window&&("localhost"!==window.location.hostname&&!window.location.hostname.includes("127.0.0.1")),this.options.serverUrl?this.isProduction&&"ws://localhost:3001"===this.options.serverUrl&&(this.options.serverUrl="wss://socket.proovd.in"):this.options.serverUrl=this.isProduction?"wss://socket.proovd.in":"ws://localhost:3001",void 0===this.options.secure&&(this.options.secure=this.isProduction),this.options.container||(this.options.container="body"),this.options.theme||(this.options.theme="light"),this.options.position||(this.options.position="bottom-right"),void 0===this.options.shadowDOM&&(this.options.shadowDOM=!0),this.options.widgets||(this.options.widgets=[{type:"viewers",enabled:!0},{type:"purchases",enabled:!1},{type:"stock",enabled:!1},{type:"urgency",enabled:!1}]),this.maxReconnectAttempts=this.options.reconnectMaxAttempts||5,this.log("Initializing with options:",this.options),!this.options.clientId||!this.options.websiteId||!this.options.serverUrl)throw console.error("ProovdPulse: Missing required options",{clientId:this.options.clientId,websiteId:this.options.websiteId,serverUrl:this.options.serverUrl}),new Error("Missing required options for ProovdPulse initialization");this.socketClient=new e(this.options.clientId,this.options.websiteId,this.options.serverUrl,{secure:this.options.secure,debug:this.options.debug,reconnectMaxAttempts:this.options.reconnectMaxAttempts,reconnectDelay:this.options.reconnectDelay}),this.socketClient.on("stats",(t=>{t.websiteId===this.options.websiteId&&this.updateWidgets({type:"viewers",count:t.activeUsers||0})})),this.socketClient.on("connect",(()=>{this.log("Connected to ProovdPulse server")})),this.socketClient.on("disconnect",(t=>{this.log("Disconnected from ProovdPulse server",t)})),this.socketClient.on("error",(t=>{this.log("Error connecting to ProovdPulse server",t)}))}async init(){try{await this.createContainer(),this.widgetsContainer&&(u.setContainer(this.widgetsContainer),u.initialize(this.options.widgets||[])),await this.socketClient.connect(),this.startTracking(),this.log("Initialized successfully")}catch(t){throw console.error("ProovdPulse: Failed to initialize",t),t}}async createContainer(){return new Promise(((t,e)=>{try{if("string"==typeof this.options.container){const t=document.querySelector(this.options.container);if(!t)throw new Error(`ProovdPulse: Container element "${this.options.container}" not found`);this.container=t}else{if(!this.options.container)throw new Error("ProovdPulse: No container specified");this.container=this.options.container}const e=document.createElement("div");if(e.className="proovd-pulse-wrapper",this.options.shadowDOM&&this.container&&"function"==typeof this.container.attachShadow){this.shadow=e.attachShadow({mode:"open"});const t=document.createElement("style");t.textContent='\n            :host {\n              all: initial;\n            }\n            .proovd-pulse-widgets-container {\n              position: relative;\n              width: 100%;\n              height: 100%;\n              font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;\n              font-size: 14px;\n              line-height: 1.5;\n              color: #333;\n            }\n          ',this.shadow.appendChild(t),this.widgetsContainer=document.createElement("div"),this.widgetsContainer.className="proovd-pulse-widgets-container",this.shadow.appendChild(this.widgetsContainer)}else this.widgetsContainer=document.createElement("div"),this.widgetsContainer.className="proovd-pulse-widgets-container",this.widgetsContainer.style.position="relative",this.widgetsContainer.style.width="100%",this.widgetsContainer.style.height="100%",e.appendChild(this.widgetsContainer);this.container&&this.container.appendChild(e),t()}catch(t){e(t)}}))}updateWidgets(t){u.update(t)}startTracking(){this.isTracking||(this.isTracking=!0,this.startTime=Date.now(),this.clickHandler=()=>{this.metrics.clickCount+=1},document.addEventListener("click",this.clickHandler),this.scrollHandler=()=>{const t=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight),e=window.scrollY||document.documentElement.scrollTop,i=window.innerHeight,o=Math.min(Math.round(e/(t-i)*100),100);this.maxScrollPercentage=Math.max(o,this.maxScrollPercentage)},document.addEventListener("scroll",this.scrollHandler),this.activityInterval=window.setInterval((()=>{this.reportActivity()}),5e3),window.addEventListener("beforeunload",(()=>{this.reportActivity(),this.destroy()})))}reportActivity(){if(!this.isTracking)return;const t=Math.round((Date.now()-this.startTime)/1e3),e={clickCount:this.metrics.clickCount,scrollPercentage:this.maxScrollPercentage,timeOnPage:t};this.socketClient.sendActivity(e),this.metrics.clickCount=0}enableWidget(t,e){if(!u.hasWidgetType(t))return void console.error(`ProovdPulse: Widget type '${t}' not registered`);const i=this.options.widgets.findIndex((e=>e.type===t));i>=0?(this.options.widgets[i].enabled=!0,e&&(this.options.widgets[i].options={...this.options.widgets[i].options,...e})):this.options.widgets.push({type:t,enabled:!0,options:e}),u.initialize(this.options.widgets)}disableWidget(t){const e=this.options.widgets.findIndex((e=>e.type===t));e>=0&&(this.options.widgets[e].enabled=!1,u.initialize(this.options.widgets))}configureWidget(t,e){const i=this.options.widgets.findIndex((e=>e.type===t));i>=0?(this.options.widgets[i].options={...this.options.widgets[i].options,...e},this.options.widgets[i].enabled&&u.initialize(this.options.widgets)):this.options.widgets.push({type:t,enabled:!1,options:e})}simulatePurchase(t,e){this.updateWidgets({type:"purchases",productName:t,timestamp:new Date,location:e})}updateStock(t,e,i){this.updateWidgets({type:"stock",productId:t,currentStock:e,initialStock:i})}showCountdown(t,e){this.updateWidgets({type:"countdown",endTime:t,message:e})}destroy(){if(this.isTracking=!1,null!==this.activityInterval&&(clearInterval(this.activityInterval),this.activityInterval=null),this.clickHandler&&(document.removeEventListener("click",this.clickHandler),this.clickHandler=null),this.scrollHandler&&(document.removeEventListener("scroll",this.scrollHandler),this.scrollHandler=null),this.socketClient.disconnect(),u.cleanUp(),this.container&&this.widgetsContainer&&this.widgetsContainer.parentNode){const t=this.widgetsContainer.parentNode;t.parentNode&&t.parentNode.removeChild(t)}this.container=null,this.widgetsContainer=null,this.shadow=null,this.log("Destroyed")}getClientId(){let t=localStorage.getItem("proovdPulseClientId");return t||(t=r(),localStorage.setItem("proovdPulseClientId",t)),t}log(t,...e){this.options.debug&&console.log(`ProovdPulse: ${t}`,...e)}}var g=Object.freeze({__proto__:null,ProovdPulse:m});if("undefined"!=typeof window&&!window.location.href.includes("localhost")){const t=document.getElementsByTagName("script"),e=t[t.length-1];let i="";if(e&&e.src){const t=e.src.match(/\/websites\/([^\/]+)\/pulse-widget\.js/);t&&t[1]&&(i=t[1],console.log("ProovdPulse: Detected website ID:",i))}i&&(document.addEventListener("DOMContentLoaded",(async function(){try{console.log("ProovdPulse: Auto-initializing...");const{ProovdPulse:t}=await Promise.resolve().then((function(){return g}));new t({websiteId:i,debug:!0,serverUrl:"wss://socket.proovd.in",container:"body"}).init().then((()=>{console.log("ProovdPulse: Auto-initialization successful")})).catch((t=>{console.error("ProovdPulse: Auto-initialization failed:",t)}))}catch(t){console.error("ProovdPulse: Error in auto-initialization:",t)}})),"complete"!==document.readyState&&"interactive"!==document.readyState||setTimeout((async function(){try{console.log("ProovdPulse: Auto-initializing (document already loaded)...");const{ProovdPulse:t}=await Promise.resolve().then((function(){return g}));new t({websiteId:i,debug:!0,serverUrl:"wss://socket.proovd.in",container:"body"}).init().then((()=>{console.log("ProovdPulse: Direct initialization successful")})).catch((t=>{console.error("ProovdPulse: Direct initialization failed:",t)}))}catch(t){console.error("ProovdPulse: Error in direct initialization:",t)}}),500))}return t.ProovdPulse=m,t}({});
