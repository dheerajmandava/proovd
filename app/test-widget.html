<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ProovdPulse Widget Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      line-height: 1.6;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      color: #333;
      border-bottom: 1px solid #eee;
      padding-bottom: 10px;
    }
    p {
      margin-bottom: 20px;
    }
    code {
      background: #f4f4f4;
      padding: 2px 5px;
      border-radius: 3px;
    }
    .content {
      min-height: 1500px;
      padding-bottom: 300px;
    }
    button {
      background: #0070f3;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin-right: 10px;
    }
    button:hover {
      background: #0051a8;
    }
    .debug {
      margin-top: 20px;
      padding: 15px;
      background: #f8f8f8;
      border-radius: 5px;
      border: 1px solid #ddd;
    }
    #logs {
      max-height: 200px;
      overflow-y: auto;
      background: #333;
      color: #fff;
      padding: 10px;
      border-radius: 5px;
      font-family: monospace;
      margin-top: 10px;
    }
    .log-entry {
      margin-bottom: 5px;
      border-bottom: 1px solid #444;
      padding-bottom: 5px;
    }
    .log-time {
      color: #aaa;
      font-size: 0.8em;
    }
  </style>
</head>
<body>
  <h1>ProovdPulse Widget Test Page</h1>
  
  <p>This page is for testing the ProovdPulse widget implementation. Scroll down, click buttons, and interact with the page to generate activity data.</p>
  
  <div class="debug">
    <h3>Debug Controls</h3>
    <button id="trigger-activity">Trigger Activity Report</button>
    <button id="fetch-stats">Fetch Stats</button>
    <button id="clear-logs">Clear Logs</button>
    
    <div>
      <h4>Console Logs:</h4>
      <div id="logs"></div>
    </div>
  </div>
  
  <div class="content">
    <h2>Sample Content</h2>
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam auctor, nisl eget ultricies tincidunt, nunc nisl aliquam nisl, eget aliquam nunc nisl eget nunc. Nullam auctor, nisl eget ultricies tincidunt, nunc nisl aliquam nisl, eget aliquam nunc nisl eget nunc.</p>
    
    <h2>Interaction Area</h2>
    <p>Click these buttons to generate click events:</p>
    <button class="test-button">Click Me!</button>
    <button class="test-button">And Me!</button>
    <button class="test-button">Me Too!</button>
    
    <h2>Scroll down to test scroll tracking</h2>
    <p>Keep scrolling to generate scroll percentage data...</p>
    
    <!-- Repeat content to make page scrollable -->
    <div id="repeat-content"></div>
  </div>

  <!-- AWS Amplify -->
  <script src="https://cdn.jsdelivr.net/npm/aws-amplify@5.0.4/dist/aws-amplify.min.js"></script>
  
  <!-- Import widget script -->
  <script src="/widget/proovd-pulse.js" 
    data-website-id="67e0e2226fd6e457ee2d2549"
    data-appsync-endpoint="ENTER_YOUR_APPSYNC_ENDPOINT_HERE"
    data-appsync-api-key="ENTER_YOUR_APPSYNC_API_KEY_HERE"
    data-appsync-region="ENTER_YOUR_AWS_REGION_HERE"></script>
  
  <script>
    // Generate repeated content
    const repeatContent = document.getElementById('repeat-content');
    for (let i = 0; i < 10; i++) {
      const section = document.createElement('div');
      section.innerHTML = `
        <h3>Section ${i+1}</h3>
        <p>More content to scroll through. This helps test the scroll tracking functionality of the ProovdPulse widget.</p>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam auctor, nisl eget ultricies tincidunt, nunc nisl aliquam nisl, eget aliquam nunc nisl eget nunc.</p>
      `;
      repeatContent.appendChild(section);
    }
    
    // Capture console logs
    const logs = document.getElementById('logs');
    
    function addLog(message) {
      const now = new Date();
      const timeStr = now.toLocaleTimeString();
      
      const logEntry = document.createElement('div');
      logEntry.className = 'log-entry';
      
      const timeSpan = document.createElement('span');
      timeSpan.className = 'log-time';
      timeSpan.textContent = `[${timeStr}] `;
      
      logEntry.appendChild(timeSpan);
      logEntry.appendChild(document.createTextNode(message));
      
      logs.appendChild(logEntry);
      logs.scrollTop = logs.scrollHeight;
    }
    
    // Override console methods
    const originalConsoleLog = console.log;
    const originalConsoleError = console.error;
    const originalConsoleWarn = console.warn;
    
    console.log = function() {
      originalConsoleLog.apply(console, arguments);
      
      // Only log ProovdPulse messages
      if (arguments[0] && typeof arguments[0] === 'string' && arguments[0].includes('ProovdPulse')) {
        addLog(Array.from(arguments).join(' '));
      }
    };
    
    console.error = function() {
      originalConsoleError.apply(console, arguments);
      
      // Only log ProovdPulse messages
      if (arguments[0] && typeof arguments[0] === 'string' && arguments[0].includes('ProovdPulse')) {
        addLog(`ERROR: ${Array.from(arguments).join(' ')}`);
      }
    };
    
    console.warn = function() {
      originalConsoleWarn.apply(console, arguments);
      
      // Only log ProovdPulse messages
      if (arguments[0] && typeof arguments[0] === 'string' && arguments[0].includes('ProovdPulse')) {
        addLog(`WARN: ${Array.from(arguments).join(' ')}`);
      }
    };
    
    // Setup debug controls
    document.getElementById('trigger-activity').addEventListener('click', function() {
      const pulseWidget = window.ProovdPulse;
      if (pulseWidget) {
        addLog('Manually triggering activity report...');
        
        const metrics = {
          scrollPercentage: Math.round(Math.random() * 100),
          timeOnPage: Math.round(Math.random() * 60) + 30,
          clickCount: Math.round(Math.random() * 5) + 1
        };
        
        pulseWidget.reportActivity(metrics);
      } else {
        addLog('ERROR: ProovdPulse widget not initialized!');
      }
    });
    
    document.getElementById('fetch-stats').addEventListener('click', function() {
      const pulseWidget = window.ProovdPulse;
      if (pulseWidget) {
        addLog('Manually fetching website stats...');
        pulseWidget.fetchWebsiteStats();
      } else {
        addLog('ERROR: ProovdPulse widget not initialized!');
      }
    });
    
    document.getElementById('clear-logs').addEventListener('click', function() {
      logs.innerHTML = '';
      addLog('Logs cleared');
    });
    
    // Track test button clicks
    document.querySelectorAll('.test-button').forEach(button => {
      button.addEventListener('click', function() {
        addLog(`Button clicked: "${this.textContent}"`);
      });
    });
  </script>
</body>
</html> 